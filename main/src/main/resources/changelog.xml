<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <!--<changeSet id="1" author="Nadezhda Tarasova">
        <dropTable tableName="users" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="2" author="Nadezhda Tarasova">
        <dropTable tableName="couriers" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="3" author="Nadezhda Tarasova">
        <dropTable tableName="dishes" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="4" author="Nadezhda Tarasova">
        <dropTable tableName="container_types" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="5" author="Nadezhda Tarasova">
        <dropTable tableName="containers" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="6" author="Nadezhda Tarasova">
        <dropTable tableName="orders" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="7" author="Nadezhda Tarasova">
        <dropTable tableName="containers_dishes" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="8" author="Nadezhda Tarasova">
        <dropTable tableName="dishes_information" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="9" author="Nadezhda Tarasova">
        <dropTable tableName="users_roles" cascadeConstraints="true"/>
    </changeSet>
    <changeSet id="10" author="Nadezhda Tarasova">
        <dropTable tableName="roles" cascadeConstraints="true"/>
    </changeSet>-->

    <!--<changeSet id="1" author="Nadezhda Tarasova">
        <dropTable tableName="clients" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="2" author="Nadezhda Tarasova">
        <dropTable tableName="couriers" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="3" author="Nadezhda Tarasova">
        <dropTable tableName="dishes" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="4" author="Nadezhda Tarasova">
        <dropTable tableName="types_of_container" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="5" author="Nadezhda Tarasova">
        <dropTable tableName="containers" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="6" author="Nadezhda Tarasova">
        <dropTable tableName="orders" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="8" author="Nadezhda Tarasova">
        <dropTable tableName="dish_information" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="9" author="Nadezhda Tarasova">
        <dropTable tableName="roles" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="11" author="Nadezhda Tarasova">
        <sql>DROP TYPE order_status</sql>
    </changeSet>

    <changeSet id="12" author="Nadezhda Tarasova">
        <sql>DROP TYPE courier_status</sql>
    </changeSet>

    <changeSet id="13" author="Nadezhda Tarasova">
        <sql>DROP TYPE dish_type</sql>
    </changeSet>-->

    <changeSet id="1" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/01.create-clients-table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="2" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/02.create-couriers-table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="3" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/03.create-orders-table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="4" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/04.create-types_of_container-table.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="5" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/05.create-containers-table.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="6" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/06.create-dishes-table.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="7" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/07.create-dish_information-table.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="8" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/08.create-index-for-orders-client_id.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="9" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/09.create-index-for-orders-courier_id.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="10" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/10.create-index-for-containers-order_id.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="11" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/11.create-index-for-containers-number_of_calories.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="12" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="db.changelog/12.create-index-for-dish_information-id.sql"
                 relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="13" author="Nadezhda Tarasova">
        <sql>CREATE TYPE courier_status AS ENUM ('ACTIVE','INACTIVE')</sql>
    </changeSet>

    <changeSet id="14" author="Nadezhda Tarasova">
        <addColumn tableName="couriers">
            <column name="status"
                    type="courier_status"/>
        </addColumn>
    </changeSet>

    <changeSet id="15" author="Nadezhda Tarasova">
        <dropColumn columnName="status"
                    tableName="orders">
        </dropColumn>
    </changeSet>

    <changeSet id="16" author="Nadezhda Tarasova">
        <sql>CREATE TYPE order_status AS ENUM ('NEW','IN_PROCESS','RECEIPT_CONFIRMED', 'COMPLETED_ON_TIME', 'COMPLETED_LATE')</sql>
    </changeSet>

    <changeSet id="17" author="Nadezhda Tarasova">
        <addColumn tableName="orders">
            <column name="status"
                    type="order_status"/>
        </addColumn>
    </changeSet>

    <changeSet id="18" author="Nadezhda Tarasova">
        <dropColumn columnName="payment_type"
                    tableName="orders">
        </dropColumn>
    </changeSet>

    <changeSet id="19" author="Nadezhda Tarasova">
        <sql>CREATE TYPE order_payment_type AS ENUM ('BY_CARD_ONLINE','BY_CARD_TO_COURIER','CASH_TO_COURIER', 'BONUS_POINTS')</sql>
    </changeSet>

    <changeSet id="20" author="Nadezhda Tarasova">
        <addColumn tableName="orders">
            <column name="payment_type"
                    type="order_payment_type"/>
        </addColumn>
    </changeSet>

    <changeSet id="21" author="Nadezhda Tarasova">
        <dropColumn columnName="dish_type"
                    tableName="dishes">
        </dropColumn>
    </changeSet>

    <changeSet id="22" author="Nadezhda Tarasova">
        <sql>CREATE TYPE dish_type AS ENUM ('MEAT','GARNISH','SALAD', 'SAUCE')</sql>
    </changeSet>

    <changeSet id="23" author="Nadezhda Tarasova">
        <addColumn tableName="dishes">
            <column name="dish_type"
                    type="dish_type"/>
        </addColumn>
    </changeSet>

    <changeSet id="24" author="Nadezhda Tarasova">
        <dropNotNullConstraint columnName="courier_id" columnDataType="number" tableName="orders"/>
    </changeSet>

    <changeSet id="25" author="Nadezhda Tarasova">
        <dropNotNullConstraint columnName="address" columnDataType="varchar" tableName="clients"/>
    </changeSet>

    <changeSet id="26" author="Nadezhda Tarasova">
        <createTable tableName="roles">
            <column name="id" type="int">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="27" author="Nadezhda Tarasova">
        <addColumn tableName="clients">
            <column name="username"
                    type="varchar(50)"/>
        </addColumn>
        <addColumn tableName="clients">
            <column name="password"
                    type="varchar(100)"/>
        </addColumn>
        <addColumn tableName="clients">
            <column name="role_id"
                    type="integer"/>
        </addColumn>
    </changeSet>

    <changeSet id="28" author="Nadezhda Tarasova">
        <addColumn tableName="couriers">
            <column name="password"
                    type="varchar(100)"/>
        </addColumn>
    </changeSet>

    <changeSet id="29" author="Nadezhda Tarasova">
        <addForeignKeyConstraint  baseColumnNames="role_id"
                                  baseTableName="clients"
                                  constraintName="role_id_fkey"
                                  onDelete="CASCADE"
                                  referencedColumnNames="id"
                                  referencedTableName="roles"/>
    </changeSet>

    <changeSet id="30" author="Nadezhda Tarasova">
        <insert tableName="roles">
            <column  name="id"  value="1"/>
            <column  name="name"  value="ROLE_USER"/>
        </insert>
        <insert tableName="roles">
            <column  name="id"  value="2"/>
            <column  name="name"  value="ROLE_COURIER"/>
        </insert>
        <insert tableName="roles">
            <column  name="id"  value="3"/>
            <column  name="name"  value="ROLE_ADMIN"/>
        </insert>
    </changeSet>

    <changeSet id="31" author="Nadezhda Tarasova">
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="750"/>
            <column name="name"  value="XS"/>
            <column name="price"  value="7"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="1000"/>
            <column name="name"  value="S"/>
            <column name="price"  value="11"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="1250"/>
            <column name="name"  value="M"/>
            <column name="price"  value="14"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="1500"/>
            <column name="name"  value="L"/>
            <column name="price"  value="17"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="1750"/>
            <column name="name"  value="XL"/>
            <column name="price"  value="21"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="2000"/>
            <column name="name"  value="XXL"/>
            <column name="price"  value="24"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="2250"/>
            <column name="name"  value="XXXL"/>
            <column name="price"  value="27"/>
        </insert>
        <insert tableName="types_of_container">
            <column name="number_of_calories"  value="2500"/>
            <column name="name"  value="XXXXL"/>
            <column name="price"  value="30"/>
        </insert>
    </changeSet>

    <!--<changeSet id="13" author="Nadezhda Tarasova">
        <sql>
            CREATE FUNCTION courier_status_checking()
            RETURNS trigger AS $BODY$
            BEGIN
            IF new.status = "active" OR new.status = "inactive"
            THEN RETURN NEW;
            ELSE RETURN NULL;
            END IF;
            END;
            $BODY$
            LANGUAGE 'plpgsql';
        </sql>
    </changeSet>

    <changeSet id="14" author="Nadezhda Tarasova">
        <sql>
            CREATE TRIGGER courier_status_checking
            BEFORE INSERT OR UPDATE
            ON Couriers
            FOR EACH ROW
            EXECUTE PROCEDURE courier_status_checking();
        </sql>
    </changeSet>-->

    <!--<changeSet id="13" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="sql/functions/create-courier-status-checking-function.sql" relativeToChangelogFile="true"/>
    </changeSet>

    <changeSet id="14" author="Nadezhda Tarasova">
        <sqlFile encoding="utf8" path="sql/triggers/create-courier-status-checking-trigger.sql" relativeToChangelogFile="true"/>
    </changeSet>-->

    <!--<changeSet id="13" author="Nadezhda Tarasova">
        <pro:createFunction catalogName="containerFoodDB"
                            dbms="postgresql"
                            encoding="UTF-8"
                            functionName="courier_status_checking"
                            path="sql/functions/create-courier-status-checking-function.sql"
                            relativeToChangelogFile="true"
                            replaceIfExists="false"
                            schemaName="public">
        </pro:createFunction>
    </changeSet>

    <changeSet id="14" author="Nadezhda Tarasova">
        <pro:createTrigger catalogName="containerFoodDB"
                           dbms="postgresql"
                           disabled="true"
                           encoding="UTF-8"
                           path="sql/triggers/create-courier-status-checking-trigger.sql"
                           relativeToChangelogFile="true"
                           replaceIfExists="false"
                           schemaName="public"
                           scope="all"
                           tableName="couriers"
                           triggerName="courier_status_checking">
        </pro:createTrigger>
    </changeSet>-->

</databaseChangeLog>


